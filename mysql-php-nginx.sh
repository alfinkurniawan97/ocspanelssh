#!/bin/bash
#

# install sql server 

echo "==================  sedang melakukan install sql server ... ===================="
echo "======================================================================================"

echo "......................................................................................"
echo "......................................................................................"

echo "======================================================================================"
echo "======================================================================================"

echo -en "\n\n"

apt-get update
apt-get -y install mysql-server
mysql_secure_installation
chown -R mysql:mysql /var/lib/mysql/ && chmod -R 755 /var/lib/mysql/
apt-get -y install nginx php5 php5-fpm php5-cli php5-mysql php5-mcrypt

echo "......................................................................................"
echo "......................................................................................"

echo "======================================================================================"
echo "======================================================================================"

echo -en "\n\n"

# install nginx dan php5

echo "==================  sedang melakukan install nginx dan php5 ... ===================="
echo "======================================================================================"

echo "......................................................................................"
echo "......................................................................................"

echo "======================================================================================"
echo "======================================================================================"

echo -en "\n\n"

rm /etc/nginx/sites-enabled/default
rm /etc/nginx/sites-available/default
mv /etc/nginx/nginx.conf /etc/nginx/nginx.conf.backup
mv /etc/nginx/conf.d/vps.conf /etc/nginx/conf.d/vps.conf.backup
wget -O /etc/nginx/nginx.conf "https://raw.githubusercontent.com/Dacung555/setup-ssh-dan-vpn/master/nginx.conf"
wget -O /etc/nginx/conf.d/vps.conf "https://raw.githubusercontent.com/Dacung555/setup-ssh-dan-vpn/master/vps.conf"
sed -i 's/cgi.fix_pathinfo=1/cgi.fix_pathinfo=0/g' /etc/php5/fpm/php.ini
sed -i 's/listen = \/var\/run\/php5-fpm.sock/listen = 127.0.0.1:9000/g' /etc/php5/fpm/pool.d/www.conf

echo "......................................................................................"
echo "......................................................................................"

echo "======================================================================================"
echo "======================================================================================"

echo -en "\n\n"

# install user dan akses nginx

echo "==================  sedang melakukan install user dan akses nginx ... ===================="
echo "======================================================================================"

echo "......................................................................................"
echo "......................................................................................"

echo "======================================================================================"
echo "======================================================================================"

echo -en "\n\n"

useradd -m vps
mkdir -p /home/vps/public_html
rm /home/vps/public_html/index.html
echo "<?php phpinfo() ?>" > /home/vps/public_html/info.php
chown -R www-data:www-data /home/vps/public_html && chmod -R g+rw /home/vps/public_html
service php5-fpm restart
service nginx restart

echo "......................................................................................"
echo "......................................................................................"

echo "======================================================================================"
echo "======================================================================================"

echo -en "\n\n"

echo "==================  silahkan setup ocs via web browser ... ===================="
echo "==================  http://ip-vps:81/info.php atau http://ip-vps:81/info.php ... ===================="
echo "==================  jika sudah lanjut kan untuk setup OCS panel ... ===================="
echo "======================================================================================"

echo "......................................................................................"
echo "......................................................................................"

echo "======================================================================================"
echo "======================================================================================"

echo -en "\n\n"
